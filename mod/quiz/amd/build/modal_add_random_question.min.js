/**
 * Contain the logic for the add random question modal.
 *
 * @module     mod_quiz/modal_add_random_question
 * @copyright  2018 Ryan Wyllie <ryan@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_quiz/modal_add_random_question",["jquery","core/notification","core/modal","core/modal_events","core/modal_registry","core/fragment","core/templates","core_form/changechecker","core/ajax"],(function($,Notification,Modal,ModalEvents,ModalRegistry,Fragment,Templates,FormChangeChecker,ajax){var registered=!1,SELECTORS_EXISTING_CATEGORY_CONTAINER='[data-region="existing-category-container"]',SELECTORS_EXISTING_CATEGORY_TAB="#id_existingcategoryheader",SELECTORS_NEW_CATEGORY_CONTAINER='[data-region="new-category-container"]',SELECTORS_NEW_CATEGORY_TAB="#id_newcategoryheader",SELECTORS_TAB_CONTENT='[data-region="tab-content"]',SELECTORS_ADD_ON_PAGE_FORM_ELEMENT='[name="addonpage"]',SELECTORS_ADD_RANDOM_BUTTON='input[type="submit"][name="addrandom"]',SELECTORS_ADD_NEW_CATEGORY_BUTTON='input[type="submit"][name="newcategory"]',SELECTORS_SUBMIT_BUTTON_ELEMENT='input[type="submit"][name="addrandom"], input[type="submit"][name="newcategory"]',SELECTORS_FORM_HEADER="legend",SELECTORS_SELECT_NUMBER_TO_ADD="#menurandomcount",SELECTORS_NEW_CATEGORY_ELEMENT="#categoryname",SELECTORS_PARENT_CATEGORY_ELEMENT="#parentcategory",SELECTORS_FILTER_CONDITION_ELEMENT="[data-filtercondition]",SELECTORS_FORM_ELEMENT="#add_random_question_form",SELECTORS_MESSAGE_INPUT='[name="message"]',ModalAddRandomQuestion=function(root){Modal.call(this,root),this.contextId=null,this.addOnPageId=null,this.category=null,this.returnUrl=null,this.cmid=null,this.loadedForm=!1};return ModalAddRandomQuestion.TYPE="mod_quiz-quiz-add-random-question",(ModalAddRandomQuestion.prototype=Object.create(Modal.prototype)).constructor=ModalAddRandomQuestion,ModalAddRandomQuestion.prototype.setContextId=function(id){this.contextId=id},ModalAddRandomQuestion.prototype.getContextId=function(){return this.contextId},ModalAddRandomQuestion.prototype.setAddOnPageId=function(id){this.addOnPageId=id,this.getBody().find(SELECTORS_ADD_ON_PAGE_FORM_ELEMENT).val(id)},ModalAddRandomQuestion.prototype.getAddOnPageId=function(){return this.addOnPageId},ModalAddRandomQuestion.prototype.setCategory=function(category){this.category=category},ModalAddRandomQuestion.prototype.getCategory=function(){return this.category},ModalAddRandomQuestion.prototype.setReturnUrl=function(url){this.returnUrl=url},ModalAddRandomQuestion.prototype.getReturnUrl=function(){return this.returnUrl},ModalAddRandomQuestion.prototype.setCMID=function(id){this.cmid=id},ModalAddRandomQuestion.prototype.getCMID=function(){return this.cmid},ModalAddRandomQuestion.prototype.moveContentIntoTab=function(tabContent,tabElement){tabContent.find(SELECTORS_FORM_HEADER).addClass("hidden"),tabContent.wrap(tabElement)},ModalAddRandomQuestion.prototype.moveTabsIntoTabContent=function(form){var tabContent=this.getBody().find(SELECTORS_TAB_CONTENT).empty();form.find('[role="tabpanel"]').wrapAll(tabContent)},ModalAddRandomQuestion.prototype.loadForm=function(){const cmid=this.getCMID(),cat=this.getCategory(),addonpage=this.getAddOnPageId(),returnurl=this.getReturnUrl();return Fragment.loadFragment("mod_quiz","add_random_question_form",this.getContextId(),{addonpage:addonpage,cat:cat,returnurl:returnurl,cmid:cmid}).then(function(html,js){var form=$(html),existingCategoryTabContent=form.find(SELECTORS_EXISTING_CATEGORY_TAB),existingCategoryTab=this.getBody().find(SELECTORS_EXISTING_CATEGORY_CONTAINER),newCategoryTabContent=form.find(SELECTORS_NEW_CATEGORY_TAB),newCategoryTab=this.getBody().find(SELECTORS_NEW_CATEGORY_CONTAINER);this.moveContentIntoTab(existingCategoryTabContent,existingCategoryTab),this.moveContentIntoTab(newCategoryTabContent,newCategoryTab),this.moveTabsIntoTabContent(form),Templates.replaceNode(this.getBody().find(SELECTORS_TAB_CONTENT),form,js)}.bind(this)).then(function(){FormChangeChecker.disableAllChecks();const numbertoadd=document.querySelector(SELECTORS_SELECT_NUMBER_TO_ADD),submitbuttons=document.querySelectorAll(SELECTORS_SUBMIT_BUTTON_ELEMENT);numbertoadd.addEventListener("change",(e=>{0!=e.target.value?submitbuttons.forEach((button=>{button.disabled=!1})):submitbuttons.forEach((button=>{button.disabled=!0}))}));const modal=this;submitbuttons.forEach((button=>{button.addEventListener("click",(e=>{var _document$querySelect;e.preventDefault();const categoryid=cat.split(",")[0],randomcount=document.querySelector(SELECTORS_SELECT_NUMBER_TO_ADD).value,filtercondition=null===(_document$querySelect=document.querySelector(SELECTORS_FILTER_CONDITION_ELEMENT).dataset)||void 0===_document$querySelect?void 0:_document$querySelect.filtercondition;let target=e.target.closest(SELECTORS_ADD_RANDOM_BUTTON);if(target)modal.addQuestions(cmid,categoryid,addonpage,randomcount,filtercondition,"","");else if(target=e.target.closest(SELECTORS_ADD_NEW_CATEGORY_BUTTON),target){let newcategory=document.querySelector(SELECTORS_NEW_CATEGORY_ELEMENT).value,parentcategory=document.querySelector(SELECTORS_PARENT_CATEGORY_ELEMENT).value;modal.addQuestions(cmid,categoryid,addonpage,randomcount,filtercondition,newcategory,parentcategory)}else;}))}))}.bind(this)).fail(Notification.exception)},ModalAddRandomQuestion.prototype.addQuestions=function(cmid,categoryid,addonpage,randomcount,filtercondition,newcategory,parentcategory){const call={methodname:"mod_quiz_add_random_question",args:{cmid:cmid,categoryid:categoryid,addonpage:addonpage,randomcount:randomcount,filtercondition:filtercondition,newcategory:newcategory,parentcategory:parentcategory}};ajax.call([call])[0].then((response=>{const form=document.querySelector(SELECTORS_FORM_ELEMENT);form.querySelector(SELECTORS_MESSAGE_INPUT).value=response.message,form.submit()})).catch(Notification.exception)},ModalAddRandomQuestion.prototype.show=function(){Modal.prototype.show.call(this),this.loadedForm||(this.loadForm(window.location.search),this.loadedForm=!0)},registered||(ModalRegistry.register(ModalAddRandomQuestion.TYPE,ModalAddRandomQuestion,"mod_quiz/modal_add_random_question"),registered=!0),ModalAddRandomQuestion}));

//# sourceMappingURL=modal_add_random_question.min.js.map